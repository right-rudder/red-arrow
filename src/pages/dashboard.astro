---
// import { app } from "../firebase/server";
// import { getAuth } from "firebase-admin/auth";
import BaseLayout from "../layouts/BaseLayout.astro";

// const auth = getAuth(app);

/* Check current session */
// if (!Astro.cookies.has("session")) {
//   return Astro.redirect("/signin");
// }
// const sessionCookie = Astro.cookies.get("session").value;
// const decodedCookie = await auth.verifySessionCookie(sessionCookie);
// const user = await auth.getUser(decodedCookie.uid);

// if (!user) {
//   return Astro.redirect("/signin");
// }

// import {
//   getAuth,
//   inMemoryPersistence,
//   signInWithEmailAndPassword,
// } from "firebase/auth";
// import { app } from "../firebase/client";

// const auth = getAuth(app);

// auth.onAuthStateChanged((user) => {
//   if (user) {
//     console.log("User is signed in: ", user);
//     window.location.href = "/dashboard";
//   }
// });
---

<BaseLayout title="dashboard">
  <div class="h-96 w-full bg-main-red"></div>
  <div id="content"></div>
  <form action="/api/auth/signout">
    <button id="signout-button" type="submit">Sign out</button>
  </form>
</BaseLayout>

<script>
  import { getAuth } from "firebase/auth";
  import { app } from "../firebase/client";
  const auth = getAuth(app);

  const setupDashboard = (user) => {
    const content = document.getElementById("content") as HTMLDivElement;
    content.innerHTML = `
      <h1>Welcome ${user.displayName}</h1>
      <p>We are happy to see you here</p>
    `;
  };

  auth.onAuthStateChanged((user) => {
    if (user) {
      setupDashboard(user);
    } else {
      window.location.href = "/signin";
    }
  });

  const signoutButton = document.getElementById(
    "signout-button",
  ) as HTMLButtonElement;
  signoutButton.addEventListener("click", (e) => {
    e.preventDefault();
    auth.signOut().then(() => {
      window.location.href = "/signin";
    });
  });
</script>
